---
title: "MySQL索引知识整理(一)"
date: 2019-11-29T17:47:17+08:00
tags: [""]
categories: [
    "Java"
]
---

## MySQL索引
- 索引是什么 ?
- 为什么是B+Tree索引 ?
- 理解索引几大原则 ?


> **引言： 正确的创建合适的索引，是提高数据库查询性能的基础**。




##  1. 索引数据结构介绍 

### 1.1 Binary Search Trees

- 优势：二分查找效率高。
- 缺陷：可能最终会形成一个线性链表。
  ​


### 1.2 Balanced Binary Search Trees

#### 1.2.1 相对平衡二叉树

一个节点的子节点的高度差不能超过1



#### 1.2.2 完全平衡二叉树 (AVL Trees)

 任意的一个节点的高度差都不能超过1



#### 1.2.3 如何保证平衡

插入不符合规范的时候会进行旋转操作。



#### 1.2.4 平衡二叉树每个节点的组成：

- 关键字：通过关键字对比来知道选择合适的数据或者指针。
-  数据区：存放数据。
- 子节点的引用(指针)
  ​


#### 1.2.5 二叉树的缺陷：

- 搜索效率不足 ：树的高度(决定了我们进行IO的次数、IO很耗时)
- 节点数据内容太少：
  - 一次IO操作加载的数据块太少。(一次交互，一页：4kb)
  - 没有利用好磁盘和IO的预读能力。(空间局部性原理)
    ​


### 1.3 B Tree

#### 1.3.1 特征

- 完全平衡：子节点的高度都在同一水平线上
- 路：子节点做多有多少个就是多少路。
-  关键字匹配：开区间
-  路数：等于关键字的个数 + 1；  
- 节点内容：关键字、数据区、子节点引用。
  ​

#### 1.3.2 优势

- 可以减少树的高度：从而减少IO次数
- 搜索效率较高
  ​



### 1.4 B+Tree

#### 1.4.1 特征

-  路：子节点做多有多少个就是多少路。
-  路数：等于关键字的个数；
- 关键字匹配：开区间
- 子节点的高度都在同一水平线上。
-  节点内容：关键字、字节的引用。
-  叶子节点内容：关键字、数据区、指向相邻叶子节点的指针。
   ​



#### 1.4.2 优势

- 具有B Tree所拥有的优势

  ​

#### 1.4.3 B+Tree 和 B Tree的区别：

- B+Tree节点搜索采用闭合区间。
- B+Tree顺序排列, 排序效率很快。扫库扫表的能力更强。
- B+Tree磁盘读写能力更强(B+Tree数据只会保存在叶子节点上 每次IO交互的关键字更多)。
- B+Tree更稳定。查询的时间比较稳定。 B Tree查询可能会很快也可能比较慢(不稳定)。
  ​



### 1.5 数据结构操作演示

[演示地址](https://www.cs.usfca.edu/~galles/visualization/Algorithms.html)




## 2. 索引

### 2.1 MySam引擎

.frm  -- 表定义文件
.MYI  -- 索引文件
.MYD  -- 数据文件

.MYI 索引文件的最末尾子节点会有一个指针(地址)指向 .MYD数据文件。
主键索引、辅助索引(二级索引) 没有区别。



### 2.2 InnoDB引擎

.frm  -- 表定义文件
.ibd  -- 索引、数据文件

.ibd 以主键为索引来组织数据的。
主键索引的叶子节点上会保存所有数据。

聚集索引：数据库表行中的物理数据和索引顺序是相同的。(InnoDB表中主键为聚集索引)
如果没有显式创建主键，InnoDB会默认创建一个RowId 大小6byte int。

辅助索引：索引文件的最末尾的子节点会有一个主键值，然后通过主键索引去定位数据。

好处：不需要维护辅助索引。



### 2.3 联合索引

- 列的离散性
  - 成正比：count(distinct col):count(col)
  - 列的离散型越高选择性就越好。 
- 最左前缀(匹配)原则
    - 关键字都是从左往右依次进行且不可跳过(经常使用的列优先作为索引。)
- 联合索引
  - 单列索引：特殊的联合索引(只包含某个字段)
  - 联合索引：有一系列字段共同组成的某个索引(例如: idx_name_age(name, age))
    ​   注意顺序问题！

### 2.4 覆盖索引

覆盖索引：查询的数据 通过叶子节点数据可以直接返回。
可通过 EXPLAIN 执行计划查看，Type > range， EXTRA里面的内容是User Index则使用了覆盖索引。 



## 3. Q&A

### 3.1 索引是什么 ?

- 索引是为了加速对表中数据行的检索而创建的一个**分散存储**的**数据结构**。



### 3.2 为什么是B+Tree索引 ?

- 排序效率很快。扫库扫表的能力更强。(叶子节点数据是顺序的)
- B+Tree磁盘读写能力更强(B+Tree数据只会保存在叶子节点上 每次IO交互的关键字更多)。
- B+Tree更稳定(B+Tree数据只会保存在叶子节点上)。



### 3.3 理解索引几大原则 ?

- 离散型高原则
- 最左匹配原则
- 最少空间原则

最左匹配原则 > 离散型高原则 > 最少空间原则