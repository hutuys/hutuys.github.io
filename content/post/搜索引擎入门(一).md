---
title: "搜索引擎入门(一)"
date: 2019-10-15T22:47:17+08:00
tags: [""]
categories: [
    "ES"
]
draft: true
---

#  1. 了解搜索引擎

搜索引擎其实实现就两步：搜索就是数据的搬运工

1，	从整个互联网获取数据，

2，	根据用户的查询需求，从自己的数据列表中取得对应的数据，返回给用户

- 从索引区出发抓取网页
- 将抓取的网页存放到临时库中进行处理
- 清理掉筛选出不符合规则的数据
- 在索引区进行分类、归档、排序，然后将结果返回

#  2. Lucene

## 2.1. Lucene是什么?
	Lucene是一套用于全文检索和搜寻的开源程序库，由Apache软件基金会支持和提供。

	Lucene提供了一个 简单 却 强大 的应用程序接口（API），能够做全文索引和搜寻，在Java开发环境里Lucene是一个成熟的免费开放源代码工具

	Lucene并不是现成的搜索引擎产品，但可以用来制作搜索引擎产品

	官网：http://lucene.apache.org/


## 2.2. 为什么要用Lucene?

- 数据库搜索模糊搜索返回的结果没有匹配度的概念
- 解决在海量数据的情况下，利用倒排索引技术，实现快速的搜索、打分(匹配度)、排序等功能 	


## 2.3. 怎么用Lucene? 何为全文检索? 何为倒排索引? 何为分词?

- 分词： 就是将整个文档的内容切分成一个个词组
- 倒排索引：记录每个词条出现在那些文档，及文档中的位置
- 全文检索: 就是对文档中的全部内容进行分词然后对单词建立倒排索引的过程。

创建倒排索引具体步骤：
1. 创建文档列表
    将原始文档数据进行编号(DocId) 形成文档列表
2. 创建倒排索引列表
    将文档中的数据进行分词，得到词条。对词条进行编号，以词条创建索引。记录包含该词条的所有文档编号(DocId)等相关信息。

## 2.4. 小结

	倒排索引创建索引的流程：
1）	首先把所有的原始文档 进行编号，形成文档列表
2）	把文档数据进行分词，得到很多的词条，以词条为索引。保存包含这些词条的文档的编号信息。

	搜索的过程：
1）	当用户输入任意的内容时，首先对用户输入的内容进行分词，得到用户要搜索的所有词条  
2）	然后拿着这些词条去倒排索引列表中进行匹配。找到这些词条就能找到包含这些词条的所有文档的编号。
3）	然后根据这些编号去文档列表中找到文档


## 2.5 Lucene快速入门

- 引入相关依赖
- 创建索引
//1,创建文档
Document document = new Document();

//2,给文档添 加字段，字段信息的参数：字段名称，字段内容，是否存储，Store.YES表示存储，Store.NO表示不存储
document.add(new StringField("id", "1", Store.YES));
document.add(new TextField("title","谷歌地图之父跳槽facebook",Store.YES));

//3,创建目录对象，使用相对目录indexDir
Directory directory = FSDirectory.open(new File("indexDir"));

//4，创建分词器对象，这里我们使用标准分词器来代替 ChineseAnalyzer，(PS：ChineseAnalyzer已经过时)
Analyzer analyzer = new StandardAnalyzer();

//5,创建文档配置对象,参数：lucene的版本，依赖的分词器对象
IndexWriterConfig conf = new IndexWriterConfig(Version.LATEST, analyzer);

//6,创建索引写入对象，参数：写入目录，及写入配置
IndexWriter indexWriter = new IndexWriter(directory, conf);

//7,写入索引
indexWriter.addDocument(document);

//8,提交
indexWriter.commit();

//9,关闭
indexWriter.close();


- 查询索引
// 索引目录对象
Directory directory = FSDirectory.open(new File("indexDir"));
// 索引读取工具
IndexReader reader = DirectoryReader.open(directory); 
// 索引搜索工具
IndexSearcher searcher = new IndexSearcher(reader);

// 创建查询解析器,两个参数：设置要查询的字段的名称，分词器
QueryParser parser = new QueryParser("title", new IKAnalyzer());
// 创建查询对象
Query query = parser.parse("谷歌地图之父拉斯");

// 搜索数据,两个参数：查询条件对象要查询的最大结果条数
// 返回的结果是 按照匹配度排名得分前N名的文档信息（包含查询到的总条数信息、所有符合条件的文档的编号信息）。
TopDocs topDocs = searcher.search(query, 10);
// 获取总条数
System.out.println("本次搜索共找到" + topDocs.totalHits + "条数据");
// 获取得分文档对象（ScoreDoc）数组.SocreDoc中包含：文档的编号、文档的得分
ScoreDoc[] scoreDocs = topDocs.scoreDocs;
for (ScoreDoc scoreDoc : scoreDocs) {
    // 取出文档编号
    int docID = scoreDoc.doc;
    // 获取文档得分
    float score = scoreDoc.score;
    // 根据编号去找文档
    Document doc = searcher.doc(docID);

    String id = doc.get("id");
    String title = doc.get("title");

    System.out.println("score: " + score +"id: " + id +"title: " + title);
}





- 修改索引
- 删除索引



## 2.6 Lucene进阶

- 高亮显示
- 排序
- 分页
- 得分算法